<!DOCTYPE html>
<html>
<head>
    <title>facebookHOF</title>
</head>
<body>

<fb:login-button
        scope="public_profile,email,user_friends"
        onlogin="auth.checkLoginState();">
</fb:login-button>


<button id="test_api">TEST API</button>

<p id="box"></p>

<script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>

<script>

    // auth class

    let auth = {
        userData: {},
        checkLoginState: function() {
            FB.getLoginStatus(function(response) {
                if (response.status === 'connected') {
                    // if user is logged in
                    console.log('User logged in. ID: ' + response.authResponse.userID);
                    auth.userData.id = response.authResponse.userID;
                    auth.userData.access_token = response.authResponse.accessToken;
                    auth.getUserData(auth.userData.access_token);
                } else {
                    // if user is logged out
                    console.log('No user logged in.');
                    //location.href = './login';
                }
            });
        },
        getUserData: function(accessToken) {
            FB.api('/me?fields=id,name,friends,friendlists', {access_token: accessToken}, function(response) {
                if (response && !response.error) {
                    auth.userData.id = response.id;
                    auth.userData.name = response.name;
                    auth.getUserPicture(auth.userData.id);
                    console.log(response);
                } else {
                    console.log(response);
                }
            });
        },
        getUserPicture: function(userID) {
            FB.api(
                "/" + userID + "/picture",
                function(response) {
                    if (response && !response.error) {
                        auth.userData.profile_pic = response.data.url;
                        console.log(response);
                        auth.buildUserProfile(auth.userData);
                    } else {
                        console.log(response);
                    }
                }
            );
        },
        buildUserProfile: function(userObj) {
            let html = `
            <h1>${userObj.name}<h1>
            <h3>${userObj.id}</h3>
            <img src="${userObj.profile_pic}">
          `;


            $('#box').html(html);
        },
        logout: function() {
            FB.logout(function(response) {
                //location.href = './login';
            });
        }
    };

    // auth init

    window.fbAsyncInit = function() {
        FB.init({
            appId: '280458762475425',
            autoLogAppEvents: true,
            xfbml: true,
            version: 'v2.11'
        });
        FB.AppEvents.logPageView();
        auth.checkLoginState();
    };

    (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {
            return;
        }
        js = d.createElement(s);
        js.id = id;
        js.src = "https://connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    // auth dom manipulation

    $('#test_api').on('click', function () {
        auth.getUserData();
    });


</script>
</body>
</html>