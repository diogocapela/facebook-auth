<!DOCTYPE html>
<html>
<head>
    <title>facebookHOF</title>
</head>
<body>

<fb:login-button
        scope="public_profile,email,user_friends"
        onlogin="checkLoginState();">
</fb:login-button>


<button id="test_api">TEST API</button>

<p id="box"></p>

<script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>

<script>
    let cachedUserData = {};

    window.fbAsyncInit = function () {

        FB.init({
            appId: '280458762475425',
            autoLogAppEvents: true,
            xfbml: true,
            version: 'v2.11'
        });

        FB.AppEvents.logPageView();

        checkLoginState();


    };

    (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {
            return;
        }
        js = d.createElement(s);
        js.id = id;
        js.src = "https://connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    function checkLoginState() {
        FB.getLoginStatus(function (response) {
            if (response.status === 'connected') {
                // if user is logged in
                console.log('User logged in. ID: ' + response.authResponse.userID);
                let auth_user_id = response.authResponse.userID;
                let auth_access_token = response.authResponse.accessToken;
                getUserData(auth_access_token);
            } else {
                // if user is logged out
                console.log('No user logged in.');
                // location.href = './login';
            }
        });
    }

    function logout() {
        FB.logout(function (response) {

        });
    }


    function getUserData(accessToken) {
        FB.api('/me?fields=id,name,friends,friendlists', {access_token: accessToken}, function (response) {
            if (response && !response.error) {
                cachedUserData.id = response.id;
                cachedUserData.name = response.name;
                getUserPic(auth_user_id);
                console.log(response);
            } else {
                console.log(response);
            }
        });
    }

    function getUserPic(userID) {
        FB.api(
            "/" + userID + "/picture",
            function (response) {
                if (response && !response.error) {
                    cachedUserData.profile_pic = response.data.url;
                    console.log(response);
                    buildProfile(cachedUserData);
                } else {
                    console.log(response);
                }
            }
        );
    }

    function buildProfile(userObj) {

        let html = `
    <h1>${userObj.name}<h1>
    <h3>${userObj.id}</h3>
    <img src="${userObj.profile_pic}">
  `;


        $('#box').html(html);

    }

    $('#test_api').on('click', function () {
        getUserData();
    });


</script>
</body>
</html>